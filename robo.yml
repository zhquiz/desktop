desktop:
  command: |
    robo -c "{{ .robo.file }}" build
    ./{{ .exe }}
serve:
  command: |
    robo -c "{{ .robo.file }}" build
    ZHQUIZ_DESKTOP=0 ./{{ .exe }}
dev:
  command: |
    export PORT=${SERVER_PORT:-5000}
    # increase the file watch limit, might be required on MacOS
    ulimit -n 1000
    reflex -s -r '\.go$' -- robo -c "{{ .robo.file }}" serve
build:
  command: |
    go build --tags "sqlite_fts5" -o {{ .exe }}
build-windows:
  command: |
    xgo \
      -ldflags="-H windowsgui" \
      -branch={{ .branch }} \
      -targets=windows/* \
      -out=zhquiz -tags="sqlite_fts5" \
      {{ .repo }}
build-mac:
  summary: |
    See https://github.com/getlantern/systray#macos for packaging and high res
  command: |
    xgo \
      -branch={{ .branch }} \
      -targets=darwin/amd64 \
      -out=zhquiz -tags="sqlite_fts5" \
      {{ .repo }}
build-linux:
  summary: |
    See https://github.com/getlantern/systray#linux

    sudo apt-get install gcc libgtk-3-dev libappindicator3-dev

    I also tried building for x86, but is unsuccessful.
  command: |
    for arch in amd64
      do
        export GOARCH="$arch"
        export CGO_ENABLED=1

        go build --tags "sqlite_fts5" -o "zhquiz-linux-$arch"
      done
build-all:
  command: |
    robo -c "{{ .robo.file }}" build-windows
    robo -c "{{ .robo.file }}" build-mac
    robo -c "{{ .robo.file }}" build-linux

##########
# Settings

variables:
  repo: github.com/zhquiz/go-zhquiz
  branch: $(git branch --show-current)
  exe: '"$([ $(go env GOOS) = "windows" ] && echo "zhquiz.exe" || echo "zhquiz.app")"'
